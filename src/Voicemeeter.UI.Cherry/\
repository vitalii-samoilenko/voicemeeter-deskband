#ifndef VOICEMEETER_UI_POLICIES_SIZE_SCALES_PRESERVERATIO_HPP
#define VOICEMEETER_UI_POLICIES_SIZE_SCALES_PRESERVERATIO_HPP

#include <tuple>

namespace Voicemeeter {
	namespace UI {
		namespace Policies {
			namespace Size {
				namespace Scales {
					struct PreserveRatio {
						template<typename... Args>
						inline ::std::tuple<Args ...> operator()(
							vector_t const &dst, Args &&...args) const {
							auto src = (args + ...);
							size_t scaleI{ 0 };
							{
								size_t r{ static_cast<size_t>(-1) };
								size_t rI{ 0 };
								for (size_t i{ 0 }; i < dst.size(); ++i) {
									num_t nom{ dst[i] };
									num_t denom{ src[i] };
									if (nom < denom) {
									} else if (rI) {
										continue;
									}
									num_t temp{ nom * SCALING_FACTOR / denom };
									if (temp < r) {
										r = temp;
									}
								}
							}
							num_t scale{
								(dst * SCALING_FACTOR / (args + ...))
									.min()
							};
							return ::std::tuple<Args ...>{
								args * scale / SCALING_FACTOR ...
							};
						};
					};
				}
			}
		}
	}
}

#endif
